"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3717],{30285:(e,t,r)=>{r.d(t,{$:()=>l,r:()=>c});var a=r(95155),o=r(12115),i=r(99708),n=r(74466),s=r(59434);let c=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=o.forwardRef((e,t)=>{let{className:r,variant:o,size:n,asChild:l=!1,...u}=e,d=l?i.DX:"button";return(0,a.jsx)(d,{className:(0,s.cn)(c({variant:o,size:n,className:r})),ref:t,...u})});l.displayName="Button"},59434:(e,t,r)=>{r.d(t,{cn:()=>i});var a=r(52596),o=r(39688);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,o.QP)((0,a.$)(t))}},66080:(e,t,r)=>{let a,o,i;r.d(t,{db:()=>i,j:()=>o});var n=r(23915),s=r(93004),c=r(35317),l=r(49509);let u={apiKey:l.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:l.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:"smart-acessorios",storageBucket:l.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:l.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:l.env.NEXT_PUBLIC_FIREBASE_APP_ID};0===(0,n.Dk)().length?(a=(0,n.Wp)(u),console.log("Firebase client app initialized.")):(a=(0,n.Sx)(),console.log("Firebase client app already initialized, getting existing app.")),o=(0,s.xI)(a),i=(0,c.aU)(a)},66681:(e,t,r)=>{r.d(t,{A:()=>u,AuthProvider:()=>l});var a=r(12115),o=r(66080),i=r(93004),n=r(35317),s=r(35695);let c=(0,a.createContext)(void 0);function l(e){var t;let{children:r}=e,[l,u]=(0,a.useState)(null),[d,g]=(0,a.useState)(null),[f,p]=(0,a.useState)(!0),h=(0,s.useRouter)(),y=(0,a.useCallback)(async e=>{console.log("useAuth: processAuthStateChange TRIGGERED. fbUser UID:",e?e.uid:"null"),p(!0);try{if(e){console.log("useAuth: fbUser detected. Setting firebaseUser state for UID:",e.uid),g(e),console.log("useAuth: Fetching Firestore data for UID:",e.uid);let t=(0,n.H9)(o.db,"usuarios",e.uid),r=await (0,n.x7)(t);if(r.exists()){let t=r.data(),a={id:e.uid,email:e.email,name:t.name||e.displayName||"Usu\xe1rio",isAdmin:t.isAdmin||!1};console.log("useAuth: Firestore data found & AuthUser set for UID: ".concat(e.uid,", Name: ").concat(a.name,", Admin: ").concat(a.isAdmin)),u(a)}else if(console.warn("useAuth: User ".concat(e.uid," authenticated (Firebase Auth) but NO Firestore document.")),e.providerData.some(e=>e.providerId===i.HF.PROVIDER_ID)){console.log("useAuth: User ".concat(e.uid," is a new social login (e.g., Google). Creating Firestore document."));let r={id:e.uid,name:e.displayName||"Usu\xe1rio Social",email:e.email||"email.social@desconhecido.com",isAdmin:!1,avatarUrl:e.photoURL||"https://placehold.co/150x150.png?text=".concat((e.displayName||"S").charAt(0).toUpperCase()),avatarHint:"user avatar social",bio:"Novo membro via login social!"};await (0,n.BN)(t,{...r,createdAt:(0,n.O5)(),updatedAt:(0,n.O5)()}),console.log("useAuth: Firestore document CREATED for new social user: ".concat(e.uid));let a={id:r.id,email:r.email,name:r.name,isAdmin:r.isAdmin};u(a)}else console.warn("useAuth: User ".concat(e.uid," authenticated via non-social method but NO Firestore document. Forcing logout.")),await (0,i.CI)(o.j)}else console.log("useAuth: No Firebase user (logged out or initial state). Clearing authUser and firebaseUser states."),u(null),g(null)}catch(e){if(console.error("useAuth: CRITICAL ERROR inside processAuthStateChange:",e),u(null),g(null),o.j.currentUser){console.log("useAuth: Attempting to sign out Firebase user due to error in processAuthStateChange.");try{await (0,i.CI)(o.j)}catch(e){console.error("useAuth: Error attempting to sign out Firebase user after error in processAuthStateChange:",e)}}}finally{console.log("useAuth: processAuthStateChange - Bloco FINALLY. Definindo isLoading para FALSE."),p(!1)}},[]);(0,a.useEffect)(()=>{console.log("useAuth: Setting up onAuthStateChanged listener.");let e=(0,i.hg)(o.j,e=>{y(e)});return()=>{console.log("useAuth: Cleaning up onAuthStateChanged listener (AuthProvider unmounted)."),e()}},[y]);let m=(0,a.useCallback)(async()=>{console.log("useAuth: logout function called."),p(!0);try{await (0,i.CI)(o.j),console.log("useAuth: signOut successful. Navigating to homepage."),h.push("/")}catch(e){console.error("useAuth: Error during signOut: ",e),p(!1)}},[h]),A=(0,a.useCallback)(async()=>{console.log("useAuth: refreshAuthUser called.");let e=o.j.currentUser;console.log("useAuth: refreshAuthUser - current Firebase user from auth.currentUser:",e?e.uid:"null"),await y(e)},[y]),b=!f&&!!l&&!!d,D=!f&&null!=(t=null==l?void 0:l.isAdmin)&&t;return a.createElement(c.Provider,{value:{user:l,firebaseUser:d,isAuthenticated:b,isAdmin:D,isLoading:f,logout:m,refreshAuthUser:A}},r)}function u(){let e=(0,a.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},93473:(e,t,r)=>{r.d(t,{f4:()=>u,kl:()=>i,mx:()=>l,uw:()=>s,yg:()=>n,zC:()=>c});var a=r(66080),o=r(35317);async function i(e){if(!a.db)return void console.error("Firestore client db instance not available in getUserById.");try{let t=(0,o.H9)(a.db,"usuarios",e),r=await (0,o.x7)(t);if(r.exists()){let e=r.data();return{...e,id:r.id,createdAt:e.createdAt,updatedAt:e.updatedAt}}return}catch(e){console.error("Error fetching user from Firestore in getUserById:",e);return}}async function n(){if(!a.db)return console.error("Firestore client db instance not available in getAllAccessories."),[];let e=(0,o.rJ)(a.db,"acessorios");try{return(await (0,o.GG)((0,o.P)(e,(0,o.My)("createdAt","desc")))).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error fetching all accessories from Firestore:",e),[]}}async function s(){let e=await n(),t=new Set;return e.forEach(e=>{e.category&&t.add(e.category)}),Array.from(t).sort()}async function c(){if(!a.db)return console.error("Firestore client db instance not available in getDailyDeals."),[];let e=(0,o.rJ)(a.db,"acessorios"),t=[];try{let r=(0,o.P)(e,(0,o._M)("isDeal","==",!0),(0,o.My)("createdAt","desc"),(0,o.AB)(6));if(t=(await (0,o.GG)(r)).docs.map(e=>({id:e.id,...e.data()})),0===t.length){console.log("No specific deals found, attempting fallback query for latest accessories.");let r=(0,o.P)(e,(0,o.My)("createdAt","desc"),(0,o.AB)(2));t=(await (0,o.GG)(r)).docs.map(e=>({id:e.id,...e.data()}))}}catch(r){if(console.error("Error fetching daily deals from Firestore:",r),"failed-precondition"===r.code&&r.message.includes("requires an index")&&(console.error("INDEX REQUIRED: The query for daily deals (isDeal == true, orderBy createdAt desc) needs a composite index. Please create it in the Firebase console."),console.error("Firebase suggested index creation link (from a similar error, may need adjustment):",r.message.substring(r.message.indexOf("https://")))),0===t.length)try{console.log("Error in primary deals query, attempting fallback for latest 2 accessories.");let r=(0,o.P)(e,(0,o.My)("createdAt","desc"),(0,o.AB)(2));t=(await (0,o.GG)(r)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error fetching fallback daily deals:",e)}}return t}async function l(){if(!a.db)return console.error("Firestore client db instance not available in getCoupons."),[];let e=(0,o.rJ)(a.db,"cupons");try{let t=o.Dc.now(),r=(0,o.P)(e,(0,o.My)("expiryDate","asc"));return(await (0,o.GG)(r)).docs.map(e=>({id:e.id,...e.data()})).filter(e=>{let r;if(!e.expiryDate)return!0;if("string"==typeof e.expiryDate)r=new Date(e.expiryDate);else if(e.expiryDate instanceof Date)r=e.expiryDate;else{if(!e.expiryDate||"function"!=typeof e.expiryDate.toDate)return!1;r=e.expiryDate.toDate()}return r>=t.toDate()}).sort((e,t)=>{let r,a;return e.expiryDate||t.expiryDate?e.expiryDate?t.expiryDate?(r="string"==typeof e.expiryDate?new Date(e.expiryDate).getTime():e.expiryDate instanceof Date?e.expiryDate.getTime():e.expiryDate&&"function"==typeof e.expiryDate.toDate?e.expiryDate.toDate().getTime():1/0,a="string"==typeof t.expiryDate?new Date(t.expiryDate).getTime():t.expiryDate instanceof Date?t.expiryDate.getTime():t.expiryDate&&"function"==typeof t.expiryDate.toDate?t.expiryDate.toDate().getTime():1/0,r-a):-1:1:0})}catch(e){return console.error("Error fetching coupons from Firestore:",e),[]}}async function u(e){if(!a.db)return console.error("Firestore client db instance not available in getLatestPosts."),[];let t=(0,o.rJ)(a.db,"posts");try{let r=(0,o.P)(t,(0,o.My)("publishedAt","desc"),(0,o.AB)(e));return(await (0,o.GG)(r)).docs.map(e=>({id:e.id,...e.data(),tags:e.data().tags||[]}))}catch(e){return console.error("Error fetching latest posts from Firestore:",e),[]}}}}]);