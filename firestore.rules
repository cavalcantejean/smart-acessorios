rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Regras para a coleção 'usuarios'
    match /usuarios/{userId} {
      // TEMPORÁRIO PARA DEBUG: Permite a criação se o usuário estiver autenticado.
      // Isso ajuda a verificar se o problema está nas condições de dados ou no request.auth.
      allow create: if request.auth.uid != null;

      // Permite leitura de perfis por qualquer usuário autenticado.
      allow read: if request.auth.uid != null;

      // Permite que o próprio usuário atualize seu perfil, mas não seu status de admin.
      allow update: if request.auth.uid == userId &&
                       (request.resource.data.isAdmin == resource.data.isAdmin || request.resource.data.isAdmin == false);

      // Permite que o próprio usuário delete sua conta.
      allow delete: if request.auth.uid == userId;
    }

    // Regras para a coleção 'acessorios' (exemplo)
    match /acessorios/{accessoryId} {
      allow read: if true; // Qualquer um pode ler acessórios
      // Adicionar mais regras para create, update, delete conforme necessário
      // Exemplo: allow write: if request.auth.token.admin == true; // Apenas admins podem escrever
    }

    // Regras para a coleção 'posts' (exemplo)
    match /posts/{postId} {
      allow read: if true; // Qualquer um pode ler posts
      // Adicionar mais regras para create, update, delete conforme necessário
    }

    // Regras para a coleção 'cupons' (exemplo)
    match /cupons/{couponId} {
      allow read: if true; // Qualquer um pode ler cupons
      // Adicionar mais regras para create, update, delete conforme necessário
    }

    // Adicione regras para outras coleções aqui...
  }
}
