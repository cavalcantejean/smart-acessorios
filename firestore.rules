
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Coleção de Usuários (usuarios)
    // REGRAS DE TESTE MINIMALISTAS E INSEGURAS PARA DEPURAÇÃO
    match /usuarios/{userId} {
      // Permite que qualquer pessoa crie um novo usuário (registre-se)
      // Esta é a regra mais permissiva possível para 'create'.
      allow create: if true;

      // Permite que qualquer pessoa leia qualquer documento de usuário.
      // INSEGURO PARA PRODUÇÃO.
      allow read: if true; 
      
      // Para o teste, vamos manter update e delete mais restritos ou comentar.
      // allow update, delete: if request.auth != null && request.auth.uid == userId;
    }

    // Outras coleções (comente ou remova para o teste se o problema persistir)
    // Se o problema de permissão ao criar usuários persistir,
    // comente temporariamente todas as outras regras de coleções abaixo
    // para garantir que não há nenhuma interferência inesperada.

    match /acessorios/{accessoryId} {
      allow get, list: if true;
      // allow create, delete, write: if false; // Temporariamente desabilitado para focar no problema de usuários
      // allow update: if false; // Temporariamente desabilitado
    }

    match /posts/{postId} {
      allow get, list: if true;
      // allow create, update, delete: if false; // Temporariamente desabilitado
    }

    match /cupons/{couponId} {
      allow get, list: if true;
      // allow create, update, delete: if false; // Temporariamente desabilitado
    }

    match /siteConfig/{configId} {
      allow get: if true;
      // allow write: if false; // Temporariamente desabilitado
    }

    match /testimonials/{testimonialId} {
      allow get, list: if true;
      // allow create, update, delete: if false; // Temporariamente desabilitado
    }
  }
}
